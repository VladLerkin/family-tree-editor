# Настройка Yandex AI для приложения

Приложение поддерживает интеграцию с Yandex Cloud AI (YandexGPT и Yandex SpeechKit) для генерации текста и распознавания речи.

## Способы подключения

### Способ 1: API ключ сервисного аккаунта (рекомендуется)

Это самый простой способ - вам нужен только API ключ. Folder ID можно не указывать (оставьте "default"), тогда будет использован каталог, в котором создан сервисный аккаунт.

#### Шаги настройки:

1. **Зарегистрируйтесь в Yandex Cloud**
   - Перейдите на [cloud.yandex.ru](https://cloud.yandex.ru)
   - Создайте аккаунт и привяжите платёжный аккаунт (есть бесплатный грант)

2. **Создайте сервисный аккаунт**
   - В консоли Yandex Cloud перейдите в раздел "Identity and Access Management" (или "Сервисные аккаунты")
   - Нажмите "Создать сервисный аккаунт"
   - Укажите имя (например, "family-tree-ai")
   - **ВАЖНО: Назначьте роли!** Без этого вы получите ошибку `PermissionDenied`.
     - `ai.languageModels.user` - для YandexGPT (генерация текста)
     - `ai.speechkit-stt.user` - для Yandex SpeechKit (распознавание речи)

3. **Создайте API ключ**
   - Выберите созданный сервисный аккаунт
   - Перейдите в раздел "API-ключи" (или "Ключи доступа" -> "Создать API-ключ")
   - Нажмите "Создать API-ключ"
   - **Сохраните ключ** - он показывается только один раз!
   - Формат ключа: `AQVN...`

4. **Настройте приложение**
   - Откройте приложение
   - Перейдите в меню → "AI Settings"
   - Выберите провайдер "YANDEX" (для генерации текста) или "Yandex SpeechKit" (для распознавания речи)
   - Вставьте API ключ в поле "Yandex Cloud API Key"
   - В поле Folder ID оставьте `default` (или укажите конкретный ID, если нужно)
   - Нажмите "Продолжить"

### Способ 2: API ключ с явным указанием Folder ID

Если вы хотите явно контролировать, какой каталог используется, можете указать Folder ID.

#### Дополнительные шаги:

1. **Найдите Folder ID**
   - В консоли Yandex Cloud выберите нужную папку (каталог)
   - Folder ID отображается вверху страницы рядом с названием папки
   - Формат: `b1g...`

2. **Укажите в настройках**
   - В настройках AI введите Folder ID в соответствующее поле
   - Это переопределит автоматическое определение каталога

## Модели YandexGPT

Приложение поддерживает следующие модели:

- **YandexGPT 4** (`yandexgpt-4`) - основная модель, более мощная
- **YandexGPT 4 Lite** (`yandexgpt-4-lite`) - облегчённая версия, быстрее и дешевле

## Yandex SpeechKit

Для распознавания речи используется тот же API ключ:

1. В настройках AI выберите "Провайдер распознавания речи" → "Yandex SpeechKit"
2. Введите тот же API ключ
3. Yandex SpeechKit особенно хорош для русского языка и языков СНГ

## Стоимость

- Первые 1000 запросов в месяц - бесплатно (грант для новых пользователей)
- YandexGPT Lite: ~0.12₽ за 1000 токенов
- YandexGPT Pro: ~0.6₽ за 1000 токенов
- SpeechKit: ~0.24₽ за минуту аудио

Актуальные цены: [yandex.cloud/ru/docs/foundation-models/pricing](https://yandex.cloud/ru/docs/foundation-models/pricing)

## Решение проблем

### Ошибка "Permission denied" (401 Unauthorized)
**Симптомы:** Ошибка вида `Permission to [resource-manager.folder ...] denied`.
**Причина:** У сервисного аккаунта нет прав на выполнение операции.
**Решение:**
1. Зайдите в консоль Yandex Cloud.
2. Найдите ваш сервисный аккаунт.
3. Убедитесь, что ему назначены роли:
   - `ai.languageModels.user` (для GPT)
   - `ai.speechkit-stt.user` (для распознавания речи)
4. Если ролей нет, добавьте их на вкладке "Роли" или при редактировании каталога.

### Ошибка "API key is required"
- Проверьте, что вы скопировали API ключ полностью
- API ключ должен начинаться с `AQVN`

### Ошибка "Folder ID is required"
- Если вы используете API ключ сервисного аккаунта, попробуйте оставить поле Folder ID со значением `default`
- Если ошибка сохраняется, укажите Folder ID явно (см. Способ 2)

## Полезные ссылки

- [Документация YandexGPT](https://yandex.cloud/ru/docs/foundation-models/concepts/yandexgpt)
- [Документация SpeechKit](https://yandex.cloud/ru/docs/speechkit/)
- [Консоль Yandex Cloud](https://console.cloud.yandex.ru/)
